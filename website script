<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personal Budget Manager</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: 'Arial', sans-serif;
    background: #f0f3f7;
    margin: 0;
    padding: 20px;
}
h1 { text-align: center; color: #333; }
.container { max-width: 1000px; margin: 0 auto; }
.card { background: white; padding: 20px; margin: 20px 0; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.08); }
input, select, button { padding: 8px; margin: 3px 0; font-size: 14px; border-radius: 6px; border: 1px solid #ccc; }
button { background: #4CAF50; color: white; border: none; cursor: pointer; }
button:hover { opacity: 0.9; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { padding: 10px; text-align: center; border-bottom: 1px solid #ddd; }
input[type=number] { width: 100px; }
.summary span { font-weight: bold; font-size: 18px; }
</style>
</head>
<body>

<div class="container">
<h1>Personal Budget Manager</h1>

<!-- Budget Selector -->
<div class="card">
    <h3>Select Budget</h3>
    <select id="budgetSelect" onchange="changeBudget()"></select>
    <input type="text" id="newBudgetName" placeholder="New budget name">
    <button onclick="createBudget()">Create Budget</button>
</div>

<!-- Section Selector -->
<div class="card">
    <select id="sectionSelect" onchange="changeSection()">
        <option value="personal">Personal Budget</option>
        <option value="investments">Investments</option>
        <option value="debt">Debt</option>
    </select>
</div>

<!-- Month & Year Selector -->
<div class="card">
    <h3>Select Month & Year</h3>
    <select id="monthSelect"></select>
    <select id="yearSelect"></select>
    <button onclick="changeMonth()">Load</button>
</div>

<!-- Income Input -->
<div class="card" id="incomeCard">
    <h3>Add Income</h3>
    <input type="number" id="incomeInput" placeholder="Enter income amount">
    <button onclick="addIncome()">Add Income</button>
</div>

<!-- Table for current section -->
<div class="card">
    <h3 id="tableTitle">Expenses Table</h3>
    <table id="budgetTable">
        <thead>
            <tr><th>Category</th><th>Amount</th></tr>
        </thead>
        <tbody></tbody>
    </table>
    <input type="text" id="newCategory" placeholder="Add custom category">
    <button onclick="addCustomCategory()">Add Category</button>
</div>

<!-- Summary -->
<div class="card">
    <h3>Summary</h3>
    <div>Total Income: $<span id="totalIncome">0</span></div>
    <div>Total Expenses: $<span id="totalExpenses">0</span></div>
    <div>Total Investments: $<span id="totalInvestments">0</span></div>
    <div>Total Debt: $<span id="totalDebt">0</span></div>
    <div>Net Worth: $<span id="netWorth">0</span></div>
</div>

<!-- Chart -->
<div class="card">
    <canvas id="expenseChart"></canvas>
</div>

</div>

<script>
/* --- Initialization --- */
const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const monthSelect = document.getElementById('monthSelect');
const yearSelect = document.getElementById('yearSelect');

months.forEach((m,i)=> monthSelect.add(new Option(m,i)));
const currentYear = new Date().getFullYear();
for(let y=currentYear-5;y<=currentYear+5;y++) yearSelect.add(new Option(y,y));
monthSelect.value = new Date().getMonth();
yearSelect.value = currentYear;

// Budget storage
let budgets = JSON.parse(localStorage.getItem('budgets')) || {};
let currentBudget = null;
let currentSection = 'personal';
let expenseChart = null;

// Preset categories
let presetCategories = {
    personal: ["Rent/Mortgage","Utilities","Groceries","Transportation","Insurance","Entertainment","Savings"],
    investments: ["Stocks","Bonds","Savings","Real Estate"],
    debt: ["Credit Card","Loan","Mortgage"]
};

// --- Functions --- //

function updateBudgetSelect(){
    const select = document.getElementById('budgetSelect');
    select.innerHTML = '';
    Object.keys(budgets).forEach(name=> select.add(new Option(name,name)));
    if(currentBudget && budgets[currentBudget]) select.value = currentBudget;
}

function createBudget(){
    const name = document.getElementById('newBudgetName').value.trim();
    if(!name) return alert('Enter budget name');
    if(budgets[name]) return alert('Budget already exists');
    budgets[name] = {
        incomeData: {},
        personalData: {},
        investmentsData: {},
        debtData: {}
    };
    currentBudget = name;
    localStorage.setItem('budgets', JSON.stringify(budgets));
    document.getElementById('newBudgetName').value = '';
    updateBudgetSelect();
    updateUI();
}

function changeBudget(){
    const select = document.getElementById('budgetSelect');
    currentBudget = select.value;
    updateUI();
}

function currentKey(){ return yearSelect.value + '-' + monthSelect.value; }
function changeMonth(){ updateUI(); }
function changeSection(){ 
    currentSection = document.getElementById('sectionSelect').value;
    document.getElementById('tableTitle').innerText = currentSection.charAt(0).toUpperCase() + currentSection.slice(1) + " Table";
    updateUI(); 
}

function addIncome(){
    const amount = parseFloat(document.getElementById('incomeInput').value);
    if(isNaN(amount)) return;
    const key = currentKey();
    budgets[currentBudget].incomeData[key] = amount;
    saveBudgets();
    document.getElementById('incomeInput').value = '';
    updateUI();
}

function addCustomCategory(){
    const cat = document.getElementById('newCategory').value.trim();
    if(!cat) return;
    if(!presetCategories[currentSection].includes(cat)) presetCategories[currentSection].push(cat);
    document.getElementById('newCategory').value = '';
    updateUI();
}

function getCurrentData(){
    if(currentSection==='personal') return budgets[currentBudget].personalData;
    if(currentSection==='investments') return budgets[currentBudget].investmentsData;
    if(currentSection==='debt') return budgets[currentBudget].debtData;
}

function saveBudgets(){
    localStorage.setItem('budgets', JSON.stringify(budgets));
}

function updateUI(){
    if(!currentBudget) return;

    const key = currentKey();
    const budget = budgets[currentBudget];
    const income = budget.incomeData[key] || 0;
    const sectionData = getCurrentData();
    if(!sectionData[key]) sectionData[key]={};
    presetCategories[currentSection].forEach(cat=>{
        if(!(cat in sectionData[key])) sectionData[key][cat]=0;
    });

    const tbody = document.querySelector('#budgetTable tbody');
    tbody.innerHTML='';
    presetCategories[currentSection].forEach(cat=>{
        const amount = sectionData[key][cat] || 0;
        const row = document.createElement('tr');
        const nameCell = document.createElement('td'); nameCell.innerText=cat;
        const amountCell = document.createElement('td');
        const input = document.createElement('input');
        input.type='number';
        input.value=amount;
        input.min=0;
        input.oninput=()=>{ 
            sectionData[key][cat]=parseFloat(input.value)||0;
            saveBudgets();
            updateUI();
        };
        amountCell.appendChild(input);
        row.appendChild(nameCell); row.appendChild(amountCell);
        tbody.appendChild(row);
    });

    // Totals
    const totalExpenses = Object.values(budget.personalData[key]||{}).reduce((a,b)=>a+b,0);
    const totalInvestments = Object.values(budget.investmentsData[key]||{}).reduce((a,b)=>a+b,0);
    const totalDebt = Object.values(budget.debtData[key]||{}).reduce((a,b)=>a+b,0);
    const netWorth = income + totalInvestments - totalDebt;

    document.getElementById('totalIncome').innerText=income.toFixed(2);
    document.getElementById('totalExpenses').innerText=totalExpenses.toFixed(2);
    document.getElementById('totalInvestments').innerText=totalInvestments.toFixed(2);
    document.getElementById('totalDebt').innerText=totalDebt.toFixed(2);
    document.getElementById('netWorth').innerText=netWorth.toFixed(2);

    // Chart for current section
    const dataObj = sectionData[key];
    const labels = Object.keys(dataObj);
    const data = Object.values(dataObj);
    if(expenseChart) expenseChart.destroy();
    const ctx = document.getElementById('expenseChart').getContext('2d');
    expenseChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels,
            datasets:[{data, backgroundColor:['#4CAF50','#FF6384','#FFCE56','#36A2EB','#9966FF','#FF9F40','#FF4444','#66CC66','#FF9999','#99CCFF']}]
        },
        options:{responsive:true}
    });
}

// Initialize: Load budgets or create default
if(Object.keys(budgets).length===0){
    currentBudget='Default Budget';
    budgets[currentBudget]={incomeData:{},personalData:{},investmentsData:{},debtData:{}};
    saveBudgets();
} else {
    currentBudget=Object.keys(budgets)[0];
}
updateBudgetSelect();
updateUI();

</script>

</body>
</html>
